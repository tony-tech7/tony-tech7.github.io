<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgriSense AI | Embedded Agent</title>
  <style>
    body { margin:0; font-family:system-ui,sans-serif; background:#0f172a; color:#fff; display:flex; justify-content:center; align-items:center; min-height:100vh; }
    .app { width:100%; max-width:1200px; background:#fff; color:#0f172a; border-radius:14px; overflow:hidden; display:flex; flex-direction:column; height:min(92vh,720px); box-shadow:0 25px 60px rgba(0,0,0,.35); }
    header { padding:16px 24px; background:linear-gradient(90deg,#22c55e,#16a34a); color:#fff; }
    header h1{margin:0;font-size:1.3rem;}
    header p{margin:4px 0 0;font-size:.9rem;opacity:.95;}
    .content{flex:1; display:grid; grid-template-columns:1fr 2fr; gap:16px; padding:16px; overflow:hidden;}
    .info{font-size:.95rem; line-height:1.6; overflow-y:auto;}
    .chat{position:relative; border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; background:#f8fafc; min-height:400px;}
    #root{width:100%; height:500px;}
    .loader{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:.9rem; color:#64748b; background:#f8fafc; z-index:1;}
    footer{padding:8px;text-align:center;font-size:.75rem;color:#64748b;background:#f8fafc;}
    @media(max-width:900px){.content{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>AgriSense AI</h1>
      <p>Smart farming assistant powered by watsonx Orchestrate</p>
    </header>
    <div class="content">
      <div class="info">
        <p>Ask AgriSense about crop selection, soil health, fertilizer usage, or seasonal risks. This demo uses the Embedded Agent channel.</p>
        <p>The same agent can be deployed to WhatsApp, Teams, or SMS in production.</p>
      </div>
      <div class="chat">
        <div class="loader" id="loader">Loading AI assistantâ€¦</div>
        <div id="root"></div>
      </div>
    </div>
    <footer>Powered by IBM watsonx Orchestrate</footer>
  </div>

  <!-- Embed script -->
  <script>
async function loadWatsonEmbed() {
  try {
    // Fetch short-lived JWT from your deployed backend
    const res = await fetch("https://tony-tech7-github-io.onrender.com/get-token");
    const data = await res.json();
    const token = data.token;

    // Configure Watsonx Orchestrate Embedded Agent
    window.wxOConfiguration = {
      orchestrationID: "9ecb30ce1ca742deb8483bb6d8832abc_c83567fe-8d32-4f0a-81d4-72627bf337b4",
      hostURL: "https://eu-gb.watson-orchestrate.cloud.ibm.com",
      rootElementID: "root",
      deploymentPlatform: "ibmcloud",
      crn: "crn:v1:bluemix:public:watsonx-orchestrate:eu-gb:a/9ecb30ce1ca742deb8483bb6d8832abc:c83567fe-8d32-4f0a-81d4-72627bf337b4::",
      chatOptions: {
        agentId: "4f25bb83-2505-4cd7-89e1-9b9f24a8af56",
        agentEnvironmentId: "a08d1085-23ad-4f2b-869a-61c2908c6be3"
      },
      authToken: token
    };

    // Load Watson embed script
    const script = document.createElement("script");
    script.src = `${window.wxOConfiguration.hostURL}/wxochat/wxoLoader.js?embed=true`;
    script.onload = () => {
      if (window.wxoLoader && typeof wxoLoader.init === "function") {
        wxoLoader.init();
        document.getElementById("loader").style.display = "none";
      }
    };
    script.onerror = () => {
      document.getElementById("loader").textContent = "Failed to load AI assistant.";
    };
    document.head.appendChild(script);
  } catch (err) {
    console.error(err);
    document.getElementById("loader").textContent = "Failed to load AI assistant.";
  }
}

loadWatsonEmbed();
</script>
</body>
</html>

